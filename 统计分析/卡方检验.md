

<h3>卡方检验</h3>

##### 简介

  卡方检验是一种用途很广的计数资料的假设检验方法。属于非参数检验，主要是比较两个及两个以上样本率（构成比）以及两个分类变量的关联性分析。根本思想在于比较理论频数和实际频数的吻合程度或者拟合优度问题。

##### 理论知识

*  基本思想

  卡方检验是以χ2分布为基础的一种常用假设检验方法，它的无效假设H0是：观察频数与期望频数没有差别。
  该检验的基本思想是：首先假设H0成立，基于此前提计算出χ2值，它表示观察值与理论值之间的偏离程度。根据χ2分布及自由度可以确定在H0假设成立的情况下获得当前统计量及更极端情况的概率P。如果P值很小，说明观察值与理论值偏离程度太大，应当拒绝无效假设，表示比较资料之间有显著差异；否则就不能拒绝无效假设，尚不能认为样本所代表的实际情况和理论假设有差别。

*  步骤

（1）提出原假设：
H0：总体X的分布函数为F(x).
如果总体分布为离散型，则假设具体为
H0：总体X的分布律为P{X=xi}=pi， i=1，2，...

（2）将总体X的取值范围分成k个互不相交的小区间A1，A2，A3，…，Ak，如可取
A1=（a0，a1]，A2=(a1，a2]，...，Ak=(ak-1,ak)，
其中a0可取-∞，ak可取+∞，区间的划分视具体情况而定，但要使每个小区间所含的样本值个数不小于5，而区间个数k不要太大也不要太小。

（3）把落入第i个小区间的Ai的样本值的个数记作fi，成为组频数（真实值），所有组频数之和f1+f2+...+fk等于样本容量n。

（4）当H0为真时，根据所假设的总体理论分布，可算出总体X的值落入第i 个小区间Ai的概率pi，于是，npi就是落入第i个小区间Ai的样本值的理论频数（理论值）。

（5）当H0为真时，n次试验中样本值落入第i个小区间Ai的频率fi/n与概率pi应很接近，当H0不真时，则fi/n与pi相差很大。基于这种思想，皮尔逊引进如下检验统计量![c](/uploads/2210f84400d91b1e4f825bf88885eac7/c.png)，在0假设成立的情况下服从自由度为k-1的卡方分布。

*  应用条件

适用于四格表应用条件：

　1.随机样本数据。两个独立样本比较可以分以下3种情况：

　(1)所有的理论数T≥5并且总样本量n≥40，用Pearson卡方进行检验。

　(2)如果理论数T＜5但T≥1，并且n≥40，用连续性校正的卡方进行检验。

　(3)如果有理论数T＜1或n＜40，则用Fisher’s检验。

　2.卡方检验的理论频数不能太小。

R×C表卡方检验应用条件：

　(1)R×C表中理论数小于5的格子不能超过1／5；

　(2)不能有小于1的理论数。如果实验中有不符合R×C表的卡方检验，可以通过增加样本数、列合并来实现。

##### 应用场景

卡方检验最常见的用途就是考察某无序分类变量各水平在两组或多组间的分布是否一致实际上，除了这个用途之外，卡方检验还有更广泛的应用。具体而言，其用途主要包括以下几个方面：

　　(1)检验某个连续变量的分布是否与某种理论分布相一致。如是否符合正态分布、是否服从均匀分布、是否服从Poisson分布等。

　　(2)检验某个分类变量各类的出现概率是否等于指定概率。如在36选7的彩票抽奖中，每个数字出现的概率是否各为1／36；掷硬币时，正反两面出现的概率是否均为0．5。

　　(3)检验某两个分类变量是否相互独立。如吸烟(二分类变量：是、否)是否与呼吸道疾病(二分类变量：是、否)有关；产品原料种类(多分类变量)是否与产品合格(二分类变量)有关。

　　(4)检验控制某种或某几种分类因素的作用以后，另两个分类变量是否相互独立。如在上例中，控制性别、年龄因素影响以后，吸烟是否和呼吸道疾病有关；控制产品加工工艺的影响后，产品原料类别是否与产品合格有关。

　　(5)检验某两种方法的结果是否一致。如采用两种诊断方法对同一批人进行诊断，其诊断结果是否一致；采用两种方法对客户进行价值类别预测，预测结果是否一致。

##### 参数及说明

`class scipy.stats.chisquare(f_obs, f_exp=None, ddof=0, axis=0)`

*  **参数**

>**f_obs: **观测值，为一个数列。

>**f_exp:** 理论值，为一个数列。如果不赋值，默认为所有情况出现的可能相等。

>**ddof:** 即自由度， df = C - 1，数值上等于所有可能的情况数-1。可以不用赋值，只要obs和exp没问题，程序可以自己算出来。

>**axis：**f_obs和f_exp的广播结果的轴，沿着它应用测试。如果axis为None，则处理f_obs中的所有值默认值为0。

*  **返回值**

>chisq：卡方检验统计量。如果axis为None或f_obs和f_exp为1-D，则该值为浮点数。

>p: 测试的p值。大于0.95即统计显著。如果ddof和返回值chisq是标量，则该值是一个浮点数。

##### **python/pyspark**样例代码

`from scipy.stats import chisquare
chi = chisquare([16, 18, 16, 14, 12, 12],f_exp=[[16, 16, 16, 16, 16, 8], [8, 20, 20, 16, 12, 12]],axis=1)
chisq = chi[0]
p = chi[1]`